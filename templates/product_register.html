{% extends "base.html" %}

{% block title %}ë†ì‚°ë¬¼ íŒë§¤ ë“±ë¡ - ë™ë„¤ë¹„ì„œ{% endblock %}

{% block content %}
<div
    style="background-color: #e0e0e0; padding: 25px; border: 3px solid #1a1a1a; border-radius: 10px; font-weight: 800; color: #1a1a1a; max-width: 500px; margin: 20px auto;">
    <h3 style="margin-top: 0; font-weight: 900; border-bottom: 2px solid #1a1a1a; padding-bottom: 10px;">ğŸ ë†ì‚°ë¬¼ íŒë§¤ ë“±ë¡
    </h3>

    <form id="productForm" onsubmit="event.preventDefault(); registerProduct();">
        <div style="margin: 20px 0;">
            <label style="display: block; margin-bottom: 5px;">íŒë§¤ í’ˆëª©ëª…</label>
            <input type="text" id="prodName" placeholder="ì˜ˆ: íƒœë°± ê³ ë­ì§€ ë°°ì¶” 10kg" required
                style="width: 100%; padding: 12px; border: 2px solid #1a1a1a; font-weight: 900; box-sizing: border-box;">
        </div>

        <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 5px;">íŒë§¤ ê°€ê²© (ì›)</label>
            <input type="number" id="prodPrice" placeholder="ì˜ˆ: 35000" required
                style="width: 100%; padding: 12px; border: 2px solid #1a1a1a; font-weight: 900; box-sizing: border-box;">
        </div>

        <div style="margin-bottom: 25px;">
            <label style="display: block; margin-bottom: 5px;">ìƒí’ˆ ì‚¬ì§„</label>
            <div onclick="document.getElementById('prodImage').click()"
                style="width: 100%; height: 150px; background: #fff; border: 2px dashed #1a1a1a; display: flex; align-items: center; justify-content: center; cursor: pointer; flex-direction: column;">
                <span id="previewText">ğŸ“· ì‚¬ì§„ ì˜¬ë¦¬ê¸° (í„°ì¹˜)</span>
                <img id="imagePreview" style="display: none; max-width: 100%; max-height: 100%; object-fit: cover;">
            </div>
            <input type="file" id="prodImage" accept="image/*" style="display: none;" onchange="previewImage(this)">
        </div>

        <div
            style="background: #1a1a1a; color: #fff; padding: 15px; border-radius: 5px; font-size: 0.9rem; line-height: 1.6; margin-bottom: 20px;">
            ğŸ“¢ **ì•ˆë‚´ì‚¬í•­**<br>
            1. ê³ ê°ì—ê²Œ ì•Œë¦¼í†¡ì„ ë³´ë‚´ë©´ ë°”ë¡œ ê²°ì œê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br>
            2. ê²°ì œ ì™„ë£Œ ì‹œ ì‚¬ì¥ë‹˜ì˜ ê³„ì¢Œë¡œ ìë™ ì…ê¸ˆë©ë‹ˆë‹¤.<br>
            3. ì•Œë¦¼í†¡ ë°œì†¡ì„ ìœ„í•´ **í¬ì¸íŠ¸ ì¶©ì „**ì´ í•„ìš”í•©ë‹ˆë‹¤.
        </div>

        <button type="submit"
            style="width: 100%; background: #27ae60; color: #fff; border: none; padding: 18px; font-size: 1.1rem; font-weight: 900; border-radius: 5px; cursor: pointer;">
            íŒë§¤ ì‹œì‘ ë° ê³ ê° ì•Œë¦¼ ë³´ë‚´ê¸°
        </button>
    </form>

    <a href="/admin/dashboard"
        style="display: block; text-align: center; margin-top: 20px; text-decoration: none; color: #1a1a1a; font-weight: 900;">ğŸ”™
        ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°</a>
</div>

<script>
    function previewImage(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById('imagePreview').src = e.target.result;
                document.getElementById('imagePreview').style.display = 'block';
                document.getElementById('previewText').style.display = 'none';
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    async function registerProduct() {
        const name = document.getElementById('prodName').value;
        const price = document.getElementById('prodPrice').value;
        const imageInput = document.getElementById('prodImage');

        if (!name || !price) {
            alert("í’ˆëª©ëª…ê³¼ ê°€ê²©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }

        const formData = new FormData();
        formData.append('name', name);
        formData.append('price', price);
        if (imageInput.files[0]) {
            formData.append('image', imageInput.files[0]);
        }

        if (!confirm("íŒë§¤ë¥¼ ë“±ë¡í•˜ê³  ì•Œë¦¼í†¡ì„ ë°œì†¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ì•Œë¦¼í†¡ ë°œì†¡ ë¹„ìš©ì´ ì°¨ê°ë©ë‹ˆë‹¤)")) return;

        try {
            const res = await fetch('/api/admin/products', {
                method: 'POST',
                body: formData
            });
            const data = await res.json();

            if (data.success) {
                alert("ìƒí’ˆì´ ë“±ë¡ë˜ì—ˆìœ¼ë©°, ê³ ê°ë“¤ì—ê²Œ ì•Œë¦¼í†¡ ë°œì†¡ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!");
                window.location.href = "/admin/dashboard";
            } else {
                alert("ë“±ë¡ ì‹¤íŒ¨: " + (data.error || "Unknown error"));
            }
        } catch (e) {
            console.error(e);
            alert("ì „ì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
    }
</script>
{% endblock %}