<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¢…í•©ì†Œë“ì„¸ ê´€ë¦¬ ë¹„ì„œ</title>
</head>

<body style="margin: 0; font-family: sans-serif; background-color: #e0e0e0; padding: 20px;">

    <header
        style="background: #1a1a1a; color: #fff; padding: 15px; border-radius: 10px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
        <h1 style="margin: 0; font-size: 1.2rem; font-weight: 900;">ğŸ“‰ ì¢…í•©ì†Œë“ì„¸ ê´€ë¦¬ ë¹„ì„œ</h1>
        <a href="/admin/dashboard" style="color: #fff; text-decoration: none; font-size: 0.9rem;">ğŸ”™ ëŒì•„ê°€ê¸°</a>
    </header>

    <div style="background-color: #e0e0e0; padding: 5px; max-width: 600px; margin: 0 auto;">

        <div
            style="background-color: #fff; padding: 25px; border: 3px solid #1a1a1a; border-radius: 10px; font-weight: 800; color: #1a1a1a;">

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px;">
                <div style="background: #fff; padding: 15px; border: 2px solid #1a1a1a;">
                    <div style="font-size: 0.8rem; margin-bottom: 5px;">ëˆ„ì  ìˆœë§ˆì§„(ë§¤ì¶œ)</div>
                    <div id="accMargin" style="font-size: 1.2rem; font-weight: 900;">0 ì›</div>
                </div>

                <div style="background: #fff; padding: 15px; border: 2px solid #1a1a1a;">
                    <div style="font-size: 0.8rem; margin-bottom: 5px;">ì¸ì • ê²½ë¹„(ì§€ì¶œ)</div>
                    <div id="accExpense" style="font-size: 1.2rem; font-weight: 900; color: #d32f2f;">0 ì›</div>
                </div>
            </div>

            <div style="margin-top: 20px; background: #1a1a1a; color: #fff; padding: 20px; border-radius: 5px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-size: 0.9rem; color: #ccc;">í˜„ì¬ ê¸°ì¤€ ì˜ˆìƒ ì†Œë“ì„¸</span>
                    <span id="predictedTax" style="font-size: 1.6rem; font-weight: 900; color: #ffeb3b;">0 ì›</span>
                </div>
                <div style="font-size: 0.75rem; color: #aaa; margin-top: 10px; line-height: 1.4;">
                    * ë‹¨ìˆœê²½ë¹„ìœ¨(33.4%) / ê°„í¸ì¥ë¶€ ê¸°ì¤€ ê°€ì‚°ì¶œ ìˆ˜ì¹˜ì…ë‹ˆë‹¤.<br>
                    * ë§¤ë‹¬ 10ë§Œì›ì”© ì„¸ê¸ˆ í†µì¥ì— ë³„ë„ ì˜ˆì¹˜í•˜ì‹œëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.
                </div>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button onclick="openChecklist()"
                    style="background: #27ae60; color: #fff; border: none; padding: 15px 30px; font-size: 1rem; font-weight: 900; cursor: pointer; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.2);">
                    ğŸ“¥ í†µí•© ì¥ë¶€ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ (êµ­ì„¸ì²­ ì–‘ì‹)
                </button>
            </div>
        </div>
    </div>

    <!-- Checklist Modal -->
    <div id="checklistModal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1000;">
        <div
            style="background-color: #fff; padding: 25px; border: 3px solid #1a1a1a; border-radius: 10px; font-weight: 800; color: #1a1a1a; width: 90%; max-width: 600px; position: relative;">
            <button onclick="closeModal()"
                style="position: absolute; top: 10px; right: 10px; border: none; background: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
            <h3 style="margin-top: 0; font-weight: 900; border-bottom: 2px solid #1a1a1a; padding-bottom: 10px;">ğŸ“¤ ì„¸ë¬´ì‚¬
                ìë£Œ ì „ì†¡ ì„¼í„°</h3>

            <div style="background: #fff; padding: 15px; border: 2px solid #1a1a1a; margin-bottom: 20px;">
                <p style="margin-top: 0; color: #d32f2f;">â€» ì „ì†¡ ì „ ë°˜ë“œì‹œ ì²´í¬í•´ì£¼ì„¸ìš”</p>
                <div style="line-height: 2;">
                    <input type="checkbox" id="check1"> <label for="check1">ê°œì¸ì ì¸ ì¹´ë“œ ì§€ì¶œì€ ì œì™¸í–ˆìŠµë‹ˆë‹¤.</label><br>
                    <input type="checkbox" id="check2"> <label for="check2">í˜„ê¸ˆ ë§¤ì¶œ ë‚´ì—­ì„ ëª¨ë‘ ì…ë ¥í–ˆìŠµë‹ˆë‹¤.</label><br>
                    <input type="checkbox" id="check3"> <label for="check3">ì¤‘ë³µëœ ì˜ìˆ˜ì¦ì´ ì—†ìŒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.</label>
                </div>
            </div>

            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 5px;">ë‹´ë‹¹ ì„¸ë¬´ì‚¬ ì´ë©”ì¼</label>
                <input type="email" id="taxEmail" placeholder="tax@expert.com"
                    style="width: 100%; padding: 12px; border: 2px solid #1a1a1a; font-weight: 900; box-sizing: border-box;">

                <label style="display: flex; gap: 10px; margin-top: 10px; cursor: pointer; align-items: center;">
                    <input type="checkbox" id="checkCC">
                    <span style="font-size: 0.9rem; color: #555;">ë‚¨ê¹€ì—†ì´ ë‚˜ì—ê²Œë„ ì°¸ì¡°(CC) ë³´ë‚´ê¸° (ê¸°ë¡ìš©)</span>
                </label>
            </div>

            <button onclick="sendToTaxAccountant()"
                style="width: 100%; background: #1a1a1a; color: #fff; border: none; padding: 20px; font-size: 1.1rem; font-weight: 900; border-radius: 5px; cursor: pointer;">
                ğŸš€ ê²€í†  ì™„ë£Œ ë° ì—‘ì…€ íŒŒì¼ ë°”ë¡œ ì „ì†¡
            </button>
        </div>
    </div>

    <script>
        function openChecklist() {
            document.getElementById('checklistModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('checklistModal').style.display = 'none';
        }

        function sendToTaxAccountant() {
            const c1 = document.getElementById('check1').checked;
            const c2 = document.getElementById('check2').checked;
            const c3 = document.getElementById('check3').checked;
            const email = document.getElementById('taxEmail').value;
            const cc = document.getElementById('checkCC').checked;

            if (!c1 || !c2 || !c3) {
                alert("ëª¨ë“  í™•ì¸ í•­ëª©ì— ì²´í¬í•´ì£¼ì„¸ìš”.");
                return;
            }

            if (!email) {
                alert("ì„¸ë¬´ì‚¬ ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }

            alert(email + " ë‹˜ì—ê²Œ ì—‘ì…€ íŒŒì¼ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.\n(ì‹¤ì œ ì „ì†¡ì€ ì„œë²„ ì—°ë™ í•„ìš”, í˜„ì¬ëŠ” íŒŒì¼ ë‹¤ìš´ë¡œë“œë¡œ ëŒ€ì²´)\n" + (cc ? "ì°¸ì¡°(CC) ë©”ì¼ë„ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤." : ""));

            // Encode parameters
            const params = new URLSearchParams({
                email: email,
                send_cc: cc
            });

            location.href = '/api/admin/ledger/export?' + params.toString();
            closeModal();
        }

        async function fetchStats() {
            try {
                const res = await fetch('/api/admin/tax/stats');
                const data = await res.json();

                document.getElementById('accMargin').innerText = data.total_revenue.toLocaleString() + " ì›";
                document.getElementById('accExpense').innerText = "- " + data.recognized_expenses.toLocaleString() + " ì›";
                document.getElementById('predictedTax').innerText = data.predicted_tax.toLocaleString() + " ì›";
            } catch (e) {
                console.error("Failed to fetch tax stats", e);
                alert("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            }
        }

        fetchStats();
    </script>
</body>

</html>