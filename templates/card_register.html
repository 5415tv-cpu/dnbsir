<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ì—…ìš© ì¹´ë“œ ë³´ì•ˆ ì—°ê²°</title>
</head>

<body
    style="margin: 0; font-family: sans-serif; background-color: #e0e0e0; padding: 20px; display: flex; justify-content: center; align-items: center; min-height: 100vh;">

    <div style="background-color: #e0e0e0; padding: 5px; width: 100%; max-width: 500px;">

        <div
            style="background-color: #fff; padding: 25px; border: 3px solid #1a1a1a; border-radius: 10px; font-weight: 800; color: #1a1a1a;">

            <div style="text-align: center; margin-bottom: 20px;">
                <span style="font-size: 2rem;">ğŸ”’</span>
                <h3 style="margin: 10px 0 0; font-weight: 900; font-size: 1.4rem;">ì‚¬ì—…ìš© ì¹´ë“œ ë³´ì•ˆ ì—°ê²°</h3>
                <p style="font-size: 0.8rem; color: #555; font-weight: 700;">ê¸ˆìœµ ë³´ì•ˆ í‘œì¤€ì— ë”°ë¼ ì•ˆì „í•˜ê²Œ ì•”í˜¸í™”ë©ë‹ˆë‹¤</p>
            </div>

            <form id="cardForm" onsubmit="event.preventDefault(); registerCard();">
                <div style="background: #fff; padding: 20px; border: 2px solid #1a1a1a; margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 10px; font-size: 0.9rem;">ì¹´ë“œ ë²ˆí˜¸ (16ìë¦¬)</label>
                    <input type="text" id="cardNumber" placeholder="â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢" maxlength="19"
                        style="width: 100%; padding: 12px; border: 1px solid #1a1a1a; font-weight: 900; letter-spacing: 3px; box-sizing: border-box;">

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-size: 0.8rem;">ìœ íš¨ê¸°ê°„ (MM/YY)</label>
                            <input type="text" id="expiry" placeholder="05 / 29" maxlength="5"
                                style="width: 100%; padding: 12px; border: 1px solid #1a1a1a; font-weight: 900; text-align: center; box-sizing: border-box;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-size: 0.8rem;">ë¹„ë°€ë²ˆí˜¸ ì• 2ìë¦¬</label>
                            <input type="password" id="pwd2" placeholder="â€¢â€¢" maxlength="2"
                                style="width: 100%; padding: 12px; border: 1px solid #1a1a1a; font-weight: 900; text-align: center; box-sizing: border-box;">
                        </div>
                    </div>
                </div>

                <div
                    style="background: #f8f9fa; padding: 12px; border: 1px solid #ccc; font-size: 0.75rem; line-height: 1.5; color: #666; margin-bottom: 20px;">
                    âœ… **ì•ˆë‚´:** ë“±ë¡ëœ ì¹´ë“œëŠ” 'ì¢…í•©ì†Œë“ì„¸' ê²½ë¹„ ì¸ì •ì„ ìœ„í•œ ë°ì´í„° ìˆ˜ì§‘ ìš©ë„ë¡œë§Œ ì‚¬ìš©ë˜ë©°, ì–´ë– í•œ ê²½ìš°ì—ë„ ì„ì˜ë¡œ ê²°ì œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                </div>

                <button type="submit"
                    style="width: 100%; background: #1a1a1a; color: #fff; border: none; padding: 18px; font-size: 1.1rem; font-weight: 900; cursor: pointer; border-radius: 5px;">
                    ì¹´ë“œ ì—°ë™ ë° ë³´ì•ˆ ì €ì¥í•˜ê¸°
                </button>
            </form>

            <a href="/admin/expenses"
                style="display: block; text-align: center; margin-top: 15px; color: #1a1a1a; font-size: 0.9rem; text-decoration: none;">ì·¨ì†Œí•˜ê³ 
                ëŒì•„ê°€ê¸°</a>
        </div>

    </div>

    <script>
        async function registerCard() {
            const btn = document.querySelector('button[type="submit"]');
            btn.disabled = true;
            btn.innerText = "ì—°ë™ ì¤‘...";

            const cardNum = document.getElementById('cardNumber').value;
            const expiry = document.getElementById('expiry').value;
            const pwd = document.getElementById('pwd2').value;

            if (cardNum.length < 10 || expiry.length < 4 || pwd.length < 2) {
                alert("ì¹´ë“œ ì •ë³´ë¥¼ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                btn.disabled = false;
                btn.innerText = "ì¹´ë“œ ì—°ë™ ë° ë³´ì•ˆ ì €ì¥í•˜ê¸°";
                return;
            }

            try {
                const res = await fetch('/api/admin/cards/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        card_number: cardNum,
                        expiry: expiry,
                        pwd_2digit: pwd
                    })
                });
                const data = await res.json();

                if (data.success) {
                    alert('ì„±ê³µì ìœ¼ë¡œ ì—°ë™ë˜ì—ˆìŠµë‹ˆë‹¤! (ë³´ì•ˆ ì €ì¥ ì™„ë£Œ)');
                    window.location.href = '/admin/expenses';
                } else {
                    alert('ì—°ë™ ì‹¤íŒ¨: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                    btn.disabled = false;
                    btn.innerText = "ì¹´ë“œ ì—°ë™ ë° ë³´ì•ˆ ì €ì¥í•˜ê¸°";
                }
            } catch (e) {
                console.error(e);
                alert("ì„œë²„ í†µì‹  ì˜¤ë¥˜");
                btn.disabled = false;
                btn.innerText = "ì¹´ë“œ ì—°ë™ ë° ë³´ì•ˆ ì €ì¥í•˜ê¸°";
            }
        }
    </script>
</body>

</html>